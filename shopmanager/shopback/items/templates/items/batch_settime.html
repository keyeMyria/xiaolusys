<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>批量设置下架时间</title>
    <link href="http://cdn.bootcss.com/bootstrap/3.2.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="{{ STATIC_URL }}jquery-timepicker-addon/timepicker/jquery-ui-timepicker-addon.css" type="text/css"/>
    <script src="http://youni.huyi.so/static/jquery/jquery-1.8.13.min.js"></script>
    <script src="http://cdn.bootcss.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="http://youni.huyi.so/static/jquery/jquery-ui-1.10.1.css"/>
    <link rel="stylesheet" type="text/css" href="/static/wap/css/sweet-alert.css">
    <script src="/static/jquery/jquery-ui-1.8.13.min.js"></script>
    <script src="/static/jquery-timepicker-addon/timepicker/jquery-ui-timepicker-addon.js"
            type="text/javascript"></script>
    <script src="/static/jquery-timepicker-addon/js/jquery-ui-timepicker-zh-CN.js"
            type="text/javascript"></script>

</head>
<body>
<div class="container" style="margin-top: 30px">
    <div class="row">
        <form method="get" action="/items/batch_settime/">
            <div class="col-xs-4">
                <input type="text" class="form-control" name="shelf_date" readonly value="{{ target_shelf_date }}"
                       id="shelfdate"/>
            </div>
            <div class="col-xs-4">
                <input type="text" class="form-control" name="outer_id" value="{{ target_product }}"
                       placeholder="请输入商品编码"/>
            </div>
            <div class="col-xs-4">
                <input type="submit" class="btn" value="搜索"/>
            </div>
        </form>
    </div>
    <div class="row panel panel-success" style="margin-top: 20px">
        <div class="panel-heading">
            <h3 class="panel-title">商品列表</h3>
        </div>
        <div class="panel-body">
            <div class="row">
                <div class="col-xs-4">
                    <input type="text" id="target_time" class="form-control" name="target_time" readonly/>
                </div>
                <div class="col-xs-4">
                    <input type="button" class="btn" id="setting" value="开始设置"/>
                </div>
            </div>
            <div class="table-responsive">
                <table class="table table-bordered table-bordered table-hover table-condensed">
                    <thead>
                    <td>全<span id="is_all_check" hidden="hidden">不</span>选<input type="checkbox" id="all_check"></td>
                    <td>编码</td>
                    <td>商品名</td>
                    <td>上架日期</td>
                    <td>下架时间</td>
                    <td>图片</td>
                    </thead>
                    {% for product in all_product %}
                        <tr class="warning">
                            <td><input type="checkbox" class="my_product" data-product-id="{{ product.id }}"/></td>
                            <td><a href="/admin/items/product/?id={{ product.id }}" target="_blank">{{ product.outer_id }}</a></td>
                            <td>{{ product.name }}</td>
                            <td>{{ product.sale_time }}</td>
                            <td>{{ product.offshelf_time }}</td>
                            <td><img src="{{ product.PIC_PATH }}" width="100px" class="img-circle"></td>
                        </tr>
                    {% endfor %}
                </table>
            </div>
        </div>
    </div>

</div>
<script src="/static/wap/js/sweet-alert.min.js"></script>
<script>
    (function () {
        $("#shelfdate").datepicker({
            dateFormat: "yy-mm-dd"
        });
        $("#target_time").datetimepicker({
            timeFormat: "HH:mm:ss",
            dateFormat: "yy-mm-dd"
        });
        $("#all_check").bind("click", function () {
            if($("#all_check").prop("checked")){
                $(".my_product").attr("checked", true);
                $("#is_all_check").show();
            }else{
                $(".my_product").attr("checked", false);
                $("#is_all_check").hide()
            }
        })
        $("#setting").bind("click", function () {
            var all_product = $(".my_product");
            var checked_product = "";
            $.each(all_product, function (index, dd) {
                var temp_product = all_product.eq(index);
                if (temp_product.prop("checked")){
                    checked_product += temp_product.attr("data-product-id")+","
                }
            })
            var settime = $("#target_time").val();
            if(settime.length==0){
                swal("您好！", "请设置时间(^_^)", "warning");

                return
            }
            if(checked_product && checked_product.length!=0){
                checked_product = checked_product.substring(0,checked_product.length-1);
            }else{
                swal("您好！", "请选择商品(^_^)", "warning");
                return
            }
            //获取分类信息
            var requestUrl = "/items/batch_settime/";

            //请求成功回调函数
            var requestCallBack = function (data) {
                swal("您好！", data.result+"(^_^)", "warning");
            };
            // 发送请求
            $.ajax({
                type: 'post',
                url: requestUrl,
                data: {"product_list": checked_product, "settime": settime},
                dataType: 'json',
                success: requestCallBack
            });
        })
    })()

</script>

</body>
</html>