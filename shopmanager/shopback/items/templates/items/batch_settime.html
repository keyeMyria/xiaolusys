<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>批量设置时间</title>
    <link href="http://cdn.bootcss.com/bootstrap/3.2.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="{{ STATIC_URL }}jquery-timepicker-addon/timepicker/jquery-ui-timepicker-addon.css" type="text/css"/>
    <script src="http://youni.huyi.so/static/jquery/jquery-1.8.13.min.js"></script>
    <script src="http://cdn.bootcss.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="http://youni.huyi.so/static/jquery/jquery-ui-1.10.1.css"/>
    <link rel="stylesheet" type="text/css" href="/static/wap/css/sweet-alert.css">
    <script src="/static/jquery/jquery-ui-1.8.13.min.js"></script>
    <script src="/static/jquery-timepicker-addon/timepicker/jquery-ui-timepicker-addon.js"
            type="text/javascript"></script>
    <script src="/static/jquery-timepicker-addon/js/jquery-ui-timepicker-zh-CN.js"
            type="text/javascript"></script>

</head>
<body>
<div class="container" style="margin-top: 30px">
    <div class="row">
        <form method="get" action="/items/batch_settime/">
            <div class="col-xs-4">
                <input type="text" class="form-control" name="shelf_date" readonly value="{{ target_shelf_date }}"
                       id="shelfdate"/>
            </div>
            <div class="col-xs-4">
                <input type="text" class="form-control" name="model_id" value="{{ model_id }}"
                       placeholder="请输入商品款式id"/>
            </div>
            <div class="col-xs-4">
                <input type="submit" class="btn" value="搜索"/>
            </div>
        </form>
    </div>
    <div class="row panel panel-success" style="margin-top: 20px">
        <div class="panel-heading">
            <h3 class="panel-title">商品列表</h3>
        </div>
        <div class="panel-body">
            <div class="row">
                <div class="col-xs-2">
                </div>
                <div class="col-xs-2">
                </div>
                <div class="col-xs-2">
                    <input type="text" id="shelf_time" class="form-control" readonly/>
                </div>
                <div class="col-xs-2">
                    <input type="text" id="unshelf_time" class="form-control" readonly/>
                </div>
                <div class="col-xs-2">
                    <select name="pro_category" id="pro_category">
                        <option value="" selected="selected">选择品类</option>
                        {% for  cate in cates %}
                            <option value="{{ cate.cid }}">{{ cate.full_cate_name }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-xs-1">
                    <select name="ware_by" id="setting_ware_by">
                        <option value="" selected="selected">选择仓库</option>
                        {% for  wareid , ware in ware_by %}
                            <option value="{{ wareid }}">{{ ware }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-xs-1">
                    <input type="button" class="btn btn-danger" id="set_target" value="设置"/>
                </div>
            </div>
            <br>

            <div class="table-responsive">
                <table class="table table-bordered table-bordered table-hover table-condensed"
                       style="text-align: center">
                    <thead>

                    <td width="5%">
                        <input type="checkbox" id="all_check" style="width: 25px;height: 25px">
                    </td>
                    <td width="10%">图片</td>

                    <td width="10%">编码</td>
                    <td width="10%">商品名</td>
                    <td width="15%">上架日期</td>
                    <td width="20%">下架时间</td>

                    <td>类别</td>
                    <td>仓库</td>
                    <td>忽略</td>
                    </thead>
                    {% for product in all_product %}
                        <tr class="warning">
                            <td>
                                <input type="checkbox" class="my_product" data-product-id="{{ product.id }}"
                                       style="width: 25px;height: 25px"/>
                            </td>
                            <td><img src="{{ product.PIC_PATH }}" width="100px" class="img-circle"></td>
                            <td>
                                <a href="/admin/items/product/?id={{ product.id }}"
                                   target="_blank">{{ product.outer_id }}-{{ product.model_id }}</a>
                            </td>
                            <td>{{ product.name }}</td>
                            <td>{{ product.sale_time }}</td>
                            <td>{{ product.offshelf_time }}</td>
                            <td>{{ product.category.name }}</td>
                            <td>{{ product.get_ware_by_display }}</td>
                            <td>
                                <span class="glyphicon glyphicon-trash" aria-hidden="true"
                                      onclick="remove_this_row(this)"></span>
                            </td>
                        </tr>
                    {% endfor %}
                </table>
            </div>
        </div>
    </div>

</div>
<script src="/static/wap/js/sweet-alert.min.js"></script>
<script>
    // 删除表中单行
    function remove_this_row(dom) {
        $(dom).parent().parent().remove();
    }

    (function () {
        $("#unshelf_time").datetimepicker({
            timeFormat: "HH:mm:ss",
            dateFormat: "yy-mm-dd"
        });
        $("#shelf_time").datepicker({
            dateFormat: "yy-mm-dd"
        });
        $("#shelfdate").datepicker({
            dateFormat: "yy-mm-dd"
        });
        $("#all_check").bind("click", function () {
            if ($("#all_check").prop("checked")) {
                $(".my_product").attr("checked", true);
            } else {
                $(".my_product").attr("checked", false);
            }
        });


        $("#set_target").bind("click", function () {
            var all_product = $(".my_product");
            var checked_product = "";

            $.each(all_product, function (index, dd) { // 获取选中的产品
                var temp_product = all_product.eq(index);
                if (temp_product.prop("checked")) {
                    checked_product += temp_product.attr("data-product-id") + ","
                }
            });
            var unshelf_time = $("#unshelf_time").val();//下架时间
            var shelf_time = $("#shelf_time").val();//上架时间
            var category = $("#pro_category").val();//类别
            var ware_by = $("#setting_ware_by").val();//所选仓库

            if (checked_product && checked_product.length != 0) {
                checked_product = checked_product.substring(0, checked_product.length - 1);
            } else {
                swal("您好！", "请选择商品", "warning");
                return
            }

            var requestUrl = "/items/batch_settime/";
            var requestCallBack = function (res) {
                if (res.result == "设置 + 成功") {
                    swal("注意！", "没有设置任何项", "warning");
                }
                else {
                    swal("您好！", res.result, "warning");
                }
            };

            var data = {
                "product_list": checked_product,
                "unshelf_time": unshelf_time,
                "shelf_time": shelf_time,
                "category": category,
                "ware_by": ware_by
            };

            $.ajax({
                type: 'post',
                url: requestUrl,
                data: data,
                dataType: 'json',
                success: requestCallBack
            });
        })
    })()
</script>

</body>
</html>