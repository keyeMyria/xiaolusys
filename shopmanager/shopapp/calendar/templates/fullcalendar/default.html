<link href="{{ STATIC_URL }}bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
<link href="{{ STATIC_URL }}bootstrap/css/bootstrap-responsive.min.css" rel="stylesheet" type="text/css" />
<link href='{{ STATIC_URL }}fullcalendar/css/fullcalendar.css' rel='stylesheet' />
<link href='{{ STATIC_URL }}fullcalendar/css/fullcalendar.print.css' rel='stylesheet' media='print' />
<link href='{{ STATIC_URL }}fullcalendar/tags/jquery.tagsinput.css' rel='stylesheet'  />
<link href='{{ STATIC_URL }}fullcalendar/js/jquery-ui-1.8.13.css' rel='stylesheet'  />
<script src='{{ STATIC_URL }}fullcalendar/js/jquery-1.8.13.min.js'></script>
<script src='{{ STATIC_URL }}fullcalendar/js/jquery-ui-1.8.13.min.js'></script>
<script src="{{ STATIC_URL }}bootstrap/js/bootstrap.js" ></script>
<script src='{{ STATIC_URL }}fullcalendar/js/jquery-ui-timepicker-addon.js'></script>
<script src='{{ STATIC_URL }}fullcalendar/js/fullcalendar.min.js'></script>
<script src='{{ STATIC_URL }}fullcalendar/tags/jquery.tagsinput.js'></script>
<script src="{{ STATIC_URL }}fullcalendar/staffevent.js" ></script>

<style>
	
	.btn-group {
		position: relative;
		display: inline-block;
		font-size: 0;
		white-space: nowrap;
		vertical-align: middle;
	}
	
	.left-nav {
		width:250px;
		display:inline;
		float:left;
		font-size: 14px;
	}
	
	.left-nav-search  .span2{
		width:140px;
	}
	
	.right-panel{
		width:900px;
	}
	
	.search-results{
		margin-top:5px;
	}
	
	.search-result-events {
		height:570px;
		overflow-y:scroll;
		overflow-x:none;
	}
	
	.event-label {
		margin-top:2px;
		width:215px;
		overflow: hidden;
	}
	
	.nav > li > a{
		padding-top:0px;
		padding-bottom:0px;
	}
	
	.search-filter{
		border:1px solid #DDD;
		padding:5px;
	}
	
	.filter-line label{
		display:inline;
		font-size:16px;
	}
	
	.filter-line select{
		display:inline;
		height:25px;
		width:95px;
		margin-bottom:8px;
		margin-right:2px;
	}
	
	.filter-line input[type="checkbox"]{
		dispaly:inline;
		margin-bottom:8px;
	}
	
	.filter-line input[type="text"]{
		display:inline;
		width:100px;
		height:16px;
		margin-right:2px;
	}
	
	#calendar {
		width:900px;
	}
	
	.add_staff_event{
		display:none;
		width:342px;
		position:absolute;
	    z-index:11111;
	}
	
	.staff-head {
		background-color:#222;
		height:25px;
		text-align:center;
		-webkit-border-radius: 5px;
    	-moz-border-radius: 5px;
	}
	
	.staff-body{
		padding:5px 2px;
		border:2px solid #999999;
		-webkit-border-radius: 5px;
    	-moz-border-radius: 5px;
    	background-color:white;
	}
	
	.control-group {
		display:block;
		margin-bottom:5px;
		clear:both;
	}
	
	.control-group a,.control-group div,.control-group input,.control-group label{
		display:inline;
	}
	
	#executors {
		width:272px;
	}
	
	.event-datetime{
		width:138px;
	}
	
	#event-content {
		width:318px;
	}
	
	.event-bottom{
		text-align:center;
	}
	
</style>
		<!--  
		<div class="left-nav">
			<div class="left-nav-search">
				<div class="input-append">
				  <input class="span2" id="appendedDropdownButton" type="text" placeholder="输入事件描述">
				  <div class="btn-group">
				    <button id="master_btn" class="btn dropdown-toggle" data-toggle="dropdown">
				     {{ object.curuser.username }}
				      <span class="caret"></span>
				    </button>
				    <ul class="dropdown-menu">
				      {% for u in object.staffs %}
				      	<li>{{ u.username }}</li>
				      {% endfor %}
				    </ul>
				  </div>
				</div>
				<div class="search-filter">
					<div class="filter-line">
						<label for="id_date_type">日期类型:</label>
						<select id="id_date_type" class="selector">
							<option value="task">任务日期</option>
							<option value="create">创建日期</option>
							<option value="modify">修改日期</option>
						</select>
						<input id="id_result_order" type="checkbox" />
						<label for="id_result_order" >降序</label> 
					</div>
					<div class="filter-line">
						<input id="id_start_dt" type="text" placeholder="开始日期"/>
						<input id="id_end_dt" type="text" placeholder="结束日期"/>
					</div>
				</div>
			</div>
			<div class="search-results">
				<div class="tabbable" > 
				  <ul class="nav nav-tabs" style="margin-bottom:0px;">
				    <li class="active"><a href="#tab1" data-toggle="tab">全部</a></li>
				    <li><a href="#tab2" data-toggle="tab">未完成</a></li>
				    <li><a href="#tab3" data-toggle="tab">已完成</a></li>
				  </ul>
				</div>
				<div class="tab-content">
					<div class="tab-pane search-result-events active" id="tab1">
						<div class="label label-info event-label">
							<label class="badge badge-inverse">1</label>
							事件一，事件一，事件一，事件一，事件一，事件一，事件一，事件一
						</div>
						<div class="label label-info event-label">
							<label class="badge badge-inverse">2</label>
							事件一，事件一，事件一，事件一，事件一，事件一，事件一，事件一
						</div>
						<div class="label label-info event-label">
							<label class="badge badge-inverse">3</label>
							事件一，事件一，事件一，事件一，事件一，事件一，事件一，事件一
						</div>
					</div>
					<div class="tab-pane search-result-events" id="tab2">
						<div class="label label-info event-label">
							<label class="badge badge-inverse">1</label>
							完成事件，完成事件，完成事件，完成事件，完成事件，完成事件
						</div>
						<div class="label label-info event-label">
							<label class="badge badge-inverse">2</label>
							完成事件，完成事件，完成事件，完成事件，完成事件，完成事件
						</div>
					</div>
					<div class="tab-pane search-result-events" id="tab3">
						<div class="label label-info event-label">
							<label class="badge badge-inverse">1</label>
							未完成事件，未完成事件，未完成事件，未完成事件，未完成事件
						</div>
					</div>
				</div>
			</div>
		</div>
		-->
		<div class="right-panel">
			<div id='calendar'></div>
			<div id="add_staff_event" class="add_staff_event draggable " >
				<div class="staff-head">
					<h4 style="color:white;padding:2px;">填写事件信息</h4>
				</div>
				<div class="staff-body">
					<div class="control-group">
						<input id="executors" name="executors" type="text" value="{{ object.curuser.username }},"  />
					</div>
					<div class="control-group">
						<input id="start-datetime" class="event-datetime" type='text' placeholder="最早执行时间" />
						<lable class="label">to</lable>
						<input id="end-datetime" class="event-datetime" type='text' placeholder="最晚完成时间" />
					</div>
					<div class="control-group">
						<div class="controls"><textarea id="event-content" rows="3" cols="50" placeholder="描述规范：开头用14字以内写任务标题，然后再写任务内容" ></textarea></div>
					</div>
					<div class="control-group event-bottom">
						<button id="btn-submit" class="btn btn-small btn-inverse">提交</button>
						<button id="btn-cancle" class="btn btn-small btn-inverse">取消</button>
					</div>
				</div>
			</div>
		</div>
	</div>
	<script type="text/javascript">
		
	//初始化日历事件对象
	var initial_calendar_events = function(calendar){
	
		var now = new Date();
		now.setMonth(now.getMonth()-1);
		var url = "/app/calendar/events/";
		var params = {'df':$.datepicker.formatDate('yy-mm-dd 00:00:01',now)};
		
		var callback = function(data){

			if (data.code==1){
				alert('数据初始化失败');
				return;
			}
			$.each(data.response_content, function(index, e) {
		         var event = {
		         	'id':e.id,
		         	'title':e.title,
		         	'start':e.start,
		         	'end':e.end,
		         	'allDay':true,
		         };
		         calendar.fullCalendar( 'renderEvent', event , true);
		    });
		};
		
		$.ajax({ 
		    type: 'GET', 
		    url: url, 
		    data: params , 
		    dataType: 'json',
		    success: callback,
		});
	};
		
	$(document).ready(function() {
	
		var date = new Date();
		var d = date.getDate();
		var m = date.getMonth();
		var y = date.getFullYear();
		var latestClickDiv = null;
		
		var calendar = $('#calendar');
		calendar.fullCalendar({
			header: {
				left: 'prev,next today',
				center: 'title',
				right: 'month,agendaWeek,agendaDay'
			},
			editable: false,
			monthNames: ['一月','二月','三月','四月','五月','六月','七月','八月','九月','十月','十一月','十二月'],
			monthNamesShort: ['1.','2.','3.','4.','5.','6.','7.','8.','9.','10.','11.','12.'],
			dayNames: ['星期日','星期一','星期二','星期三','星期四','星期五','星期六'],
			dayNamesShort: ['日','一','二','三','四','五','六'],
			buttonText: {
				prev: "<span class='fc-text-arrow'>&lsaquo;</span>",
				next: "<span class='fc-text-arrow'>&rsaquo;</span>",
				prevYear: "<span class='fc-text-arrow'>&laquo;</span>",
				nextYear: "<span class='fc-text-arrow'>&raquo;</span>",
				today: '今天',
				month: '月',
				week: '周',
				day: '天',
			},
			
			dayClick: function(date, allDay, jsEvent, view) {
				
				if (latestClickDiv){
					latestClickDiv.css('background-color', 'white');
				}
				
                $(this).css('background-color', 'pink');
				$("#start-datetime").datetimepicker('setDate', (date))
				var pos = {'x':jsEvent.clientX,'y':jsEvent.clientY}
        		showStaffEventAddDialog(pos);
				
				latestClickDiv = $(this);
    		},
    		eventClick: function(calEvent, jsEvent, view) {
        		$(this).css('border-color', 'red');
    		},
    		viewDisplay: function(view){
    			$('#add_staff_event').hide();
    		},
    		
		});
		initial_calendar_events(calendar);
		
	});
	//使输入的执行标记化
	$('#executors').tagsInput({
		'autocomplete_url': '/users/username/',
  		'autocomplete': {selectFirst:true, width:'100px',autoFill:true},
		'height':'100px',
		'width':'260px',
		'interactive':true,
		'defaultText':'事件分配给',
		'placeholderColor' : '#999999',
		'removeWithBackspace' : true,
	    'minChars' : 1,
	    'maxChars' : 10,
	});
	//设置填写事件对话框可拖动
	$( "#add_staff_event" ).draggable({ containment: "parent" });
	
	$("#start-datetime").datetimepicker({
                timeFormat: "HH:mm:ss",
                dateFormat: "yy-mm-dd"
            });
	$("#end-datetime").datetimepicker({
                timeFormat: "HH:mm:ss",
                dateFormat: "yy-mm-dd"
            });
    //初始化添加事件对话框
	initStaffEventAddDialog();
	</script>
