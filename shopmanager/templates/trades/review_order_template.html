<!DOCTYPE html>
<html >
  <head>
    <title>{% block title %}{% endblock %}</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <link href="{{ STATIC_URL }}bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
    <link href="{{ STATIC_URL }}bootstrap/css/bootstrap-responsive.min.css" rel="stylesheet" type="text/css" />
    <link href="{{ STATIC_URL }}css/base.less" rel="stylesheet/less" type="text/css" />
    <script src="{{ STATIC_URL }}script/jquery-1.7.1.min.js" type="text/javascript"></script>
    <style type="text/css">
    body,div{
    	margin:0px auto;
    	padding:0px;
    }
    body{
    	width:1000px;
    	#text-align:center;
    }
    .table-bordered {
	    border: 1px solid #DDD;
	    border-collapse: separate;
	    border-left: 0;
	    border-top:0;
	    -webkit-border-radius: 4px;
	    -moz-border-radius: 4px;
	    border-radius: 4px;
	}
	
	.table {
	    width: 100%;
	    margin-bottom: 18px;
	}
	
	table {
	    max-width: 100%;
	    background-color: transparent;
	    border-collapse: collapse;
	    border-spacing: 0;
	}
	
	tr {
	    display: table-row;
	    vertical-align: inherit;
	    border-color: inherit;
	}
	
	.table-bordered th, .table-bordered td {
	    border-left: 1px solid #DDD;
	}
	.table th, .table td {
	    padding: 8px;
	    line-height: 18px;
	    text-align: left;
	    vertical-align: top;
	    border-top: 1px solid #DDD;
	}
	
	.table tbody tr:hover td, .table tbody tr:hover th {
	    background-color: whiteSmoke;
	}
    .alert-message {
	    padding: 8px 35px 8px 14px;
	    margin-bottom: 18px;
	    text-shadow: 0 1px 0 rgba(255, 255, 255, 0.5);
	    border: 1px solid #FBEED5;
	    -webkit-border-radius: 4px;
	    -moz-border-radius: 4px;
	    border-radius: 4px;
	}
    .seller {
	    color: #B94A48;
	    background-color: #F2DEDE;
	    border-color: #EED3D7;
	}
    .buyer {
	    color: #C09853;
	    background-color: #FCF8E3;
	}
    .simple-label {
	    color:#999;
	    display:inline;
	}
	
	.thumbnails1 {
	    margin-left: -20px;
	    list-style: none;
	    height:18px;
	}
	
	.thumbnails1 > li {
	    float: left;
	    margin-left: 20px;
	}
	.badge1 {
	    padding: 1px 9px 2px;
	    -webkit-border-radius: 9px;
	    -moz-border-radius: 9px;
	    border-radius: 9px;
	}
	
	.badge1 {
	    font-size: 10.998px;
	    font-weight: bold;
	    line-height: 14px;
	    color: white;
	    text-shadow: 0 -1px 0 rgba(0, 0, 0, 0.25);
	    white-space: nowrap;
	    vertical-align: baseline;
	    background-color: #999;
	}
	
	.badge-warning1 {
	    background-color: #DA4F49;
	}
	.bottom-area{
		text-align:center;
	}
    </style>
  </head>
{% load trade_tags %} 
{% with trade=object.trade logistics=object.logistics %}
  <body>
	<div >
		<fieldset>
			<legend>问题列表</legend>
			<div style="padding: 9px 15px">
				<ul class="thumbnails1">
					{% if trade.new_memo %}<li><span class="badge1 badge-warning1">新留言</span></li>{% endif %} 
					{% if trade.new_refund %}<li><span class="badge1 badge-warning1">新退款</span></li>{% endif %} 
					{% if trade.order_modify %}<li><span class="badge1 badge-warning1">订单修改</span></li>{% endif %} 
					{% if trade.addr_modify %}<li><span class="badge1 badge-warning1">修改地址</span></li>{% endif %}
				</ul>
			</div>
		</fieldset>
		<fieldset>
			<legend>基本信息</legend>
			<div class="row-through">
				<input type="hidden" id="id_review_trade" name="trade_id" value="{{ trade.id }}">
				<input type="hidden" id="id_trade_status" name="trade_status" value="{{ trade.sys_status }}">
				<div style="display: inline-block; width: 18%;" class="trade_info"><label class="simple-label">订单号: </label>{{ trade.id }}</div>
				<div style="display: inline-block; width: 18%;" class="trade_info"><label class="simple-label">买家: </label>{{ trade.buyer_nick }}</div>
				<div style="display: inline-block; width: 18%;" class="trade_info"><label class="simple-label">店铺: </label>{{ trade.seller_nick }}</div>
				<div style="display: inline-block; width: 18%;" class="trade_info"><label class="simple-label">付款时间: </label>{{ trade.pay_time }}</div>
				<div style="display: inline-block; width: 18%;" class="trade_info"><label class="simple-label">发货日期: </label>{{ trade.consign_time }}</div>
				<br><br>
				<div style="display: inline-block; width: 18%;" class="trade_info"><label class="simple-label">实付款: </label>{{ trade.payment }}</div>
				<div style="display: inline-block; width: 18%;" class="trade_info"><label class="simple-label">邮费: </label>{{ trade.post_fee }}</div>
				<div style="display: inline-block; width: 18%;" class="trade_info"><label class="simple-label">快递公司: </label>
					<span id="id_logistic_name">{{ trade.logistics_company.name }}</span></div>
				<div style="display: inline-block; width: 18%;" class="trade_info"><label class="simple-label">快递单号: </label>
					<span id="id_out_sid">{{ trade.out_sid }}</span></div>
				<br><br>
				<div style="display: inline-block; width: 18%;" class="trade_info"><label class="simple-label">收货人: </label>{{ trade.receiver_name }}</div>
				<div style="display: inline-block; width: 18%;"  class="trade_info"><label class="simple-label">省: </label>{{ trade.receiver_state }}</div>
				<div style="display: inline-block; width: 18%;"  class="trade_info"><label class="simple-label">市: </label>{{ trade.receiver_city }}</div>
				<div style="display: inline-block; width: 18%;" class="trade_info"><label class="simple-label">区: </label>{{ trade.receiver_district }}</div>
				<div style="display: inline-block; width: 18%;" class="trade_info">
					<label class="simple-label">联系方式: </label>
					{% if trade.receiver_mobile %}{{ trade.receiver_mobile }}{% else %}{{ trade.receiver_phone }}{% endif %}
				</div>
				<br><br>
				<div style="display: inline-block; width: 100%;" class="trade_info"><label class="simple-label">详细地址: </label>{{ trade.receiver_address }}</div>
			</div>
			<div class="row-through">
				<div class="alert-message buyer"><strong>买家留言: </strong>{{ trade.buyer_message }}</div>
				<div class="alert-message seller"><strong>卖家留言: </strong>{{ trade.seller_memo }}</div>
			</div>
			<div>
				<div id="id_express_content" class="accordion-inner1">
					<label class="simple-label">选择快递:</label> 
					<select id="id_logistics" class="selection">
						{% for lg in logistics %}
						<option value='{{ lg.code }}' {% if lg.id == trade.logistics_company.id %}selected{% endif %} >{{ lg.name }}</option>
						{% endfor %}
					</select>
					&nbsp;&nbsp;
					<label class="simple-label">快递单号:</label>
					<input type="text" id="id_express_no" />
					&nbsp;&nbsp;
					<button id="id-chg-express-no-btn" class="btn-mini btn-success">确认修改</button> 
				</div>
			</div>
		</fieldset>
		<fieldset>
			<legend>订单信息(总数量{{ trade.order_nums }})</legend>
			<table class="table table-bordered table-striped table-condensed">
				<tr>
					<th>ID</th>
					<th>商品编码</th>
					<th>商品名称</th>
					<th>规格编码</th>
					<th>规格名称</th>
					<th>数量</th>
					<th>类型</th>
				</tr>
				{% for order in trade.used_orders %}
				<tr>
					<td>{{ order.id }}</td>
					<td>{{ order.outer_id }}</td>
					<td>{{ order|prod_name }}</td>
					<td>{{ order.outer_sku_id }}</td>
					<td>{{ order|sku_name }}</td>
					<td>{{ order.num }}</td>
					<td>{% if order.gift_type == 0 %}实付{% elif order.gift_type == 1 %}赠送{% elif order.gift_type == 2 %}
					满就送{% elif order.gift_type == 3 %}拆分{% elif order.gift_type == 4 %}换货{% endif %}</td>
				</tr>
				{% endfor %}
			</table>
		</fieldset>
		<div class="bottom-area" >
			{% if trade.can_review %}
			<button id="id-review-order-btn" class="btn-large btn-primary">复审通过</button>
			{% else %}
			<button id="id-review-order-btn" class="btn-large " disabled="disabled">客服未处理，暂不能复审</button>
			{% endif %}
		</div>
	</div>
	<script type="text/javascript">
		var change_logistic = function(evt){
			var trade_id      = $('#id_review_trade').val();
			var logistic_code = $('#id_logistics').val();
			var out_sid       = $('#id_express_no').val();
			if (logistic_code == '' || out_sid == ''){
				alert('物流单号不能为空');
			}else{
				$.post('/trades/logistic/',
					{'trade_id':trade_id,'logistic_code':logistic_code,'out_sid':out_sid},
					function(data, textStatus){
						if (data.code == 0){
							$('#id_logistic_name').html(data.response_content.logistic_company_name);
							$('#id_out_sid').html(data.response_content.out_sid);
						}else{
							alert('快递单号修改失败:'+data.response_content);
						}
					},
					'json');
			}
		};
		
		var review_order  = function(evt){
			var trade_id      = $('#id_review_trade').val();
			$.post('/trades/revieworder/'+trade_id+'/',
				{},
				function(data, textStatus){
					if(data.code == 0){
						console.log(data);
						//window.location = '/trades/revieworder/'+trade_id+'/';
					}else{
						alert('订单复核失败:'+data.response_error);
					}
				},
				'json');
		};
		
		$('#id-chg-express-no-btn').click(change_logistic);
		$('#id-review-order-btn').click(review_order);
	</script>
</body>
{% endwith %}
</html>
