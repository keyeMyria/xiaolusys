<!DOCTYPE html>
<html >
  <head>
    <title>创建采购单</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
     <link href="{{ STATIC_URL }}bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
    <link href="{{ STATIC_URL }}bootstrap/css/bootstrap-responsive.min.css" rel="stylesheet" type="text/css" />
    <link href="{{ STATIC_URL }}css/base.less" rel="stylesheet/less" type="text/css" />
    <script src="{{ STATIC_URL }}closure-library/closure/goog/base.js"></script>
    <script src="{{ STATIC_URL }}jquery/jquery-1.8.13.min.js" type="text/javascript"></script>
    <script src="{{ STATIC_URL }}jquery/jquery-ui-1.8.13.css" type="text/javascript"></script>
    <script src="{{ STATIC_URL }}jquery/jquery-ui-1.8.13.min.js" type="text/javascript"></script>
    <script src="{{ STATIC_URL }}jquery-datatable-addon/jquery.dataTables.min.js" type="text/javascript"></script>
    <style type="text/css" title="currentStyle">
		@import "{{ STATIC_URL }}jquery-datatable-addon/css/demo_page.css";
		@import "{{ STATIC_URL }}jquery-datatable-addon/css/demo_table.css";
    </style>  
    <style type="text/css">
    body,div{
    	margin:0px auto;
    	padding:0px;
    }
    body{
    	width:1000px;
    }
    .table-bordered {
	    border: 1px solid #DDD;
	    border-collapse: separate;
	    border-left: 0;
	    border-top:0;
	    -webkit-border-radius: 4px;
	    -moz-border-radius: 4px;
	    border-radius: 4px;
	}
	.table {
	    width: 100%;
	    margin-bottom: 18px;
	}
	table {
	    max-width: 100%;
	    background-color: white;
	    border-collapse: collapse;
	    border-spacing: 0;
	}
	tr {
	    display: table-row;
	    vertical-align: inherit;
	    border-color: inherit;
	}
	.table-bordered th, .table-bordered td {
	    border-left: 1px solid #DDD;
	}
	.table tbody tr:hover td, .table tbody tr:hover th {
	    background-color: whiteSmoke;
	}
    .simple-text {
	    width:120px;
	    height:16px;
	    display:inline;
	    margin:0px 0px;
	}
	.content-main{
		margin-top:40px;
		display:fixed;
	}
	.content-base-info {
		display:fixed;
	}
	
	label{
		display:inline;
		margin:0px 10px;
	}
	
	select {
		width:130px;
		display:inline;
		
	}
	.head-left {
		display:inline;
	}
	.head-right{
		float:right;
		margin-right:10px;
		display:inline;
	}
	.product-search{
		margin:0px 10px;
	}
	.trade-search{
		float:right;
	}
	.content-search {
		width:100%;
		height:20px;
	}
	.table {
		border-color: gray;
	}
	.table td input[type="text"]{
		width:120px;
	}
	h2,h4{
		m
	}
    </style>
  </head>

{% with suppliers=object.suppliers deposites=object.deposites purchase_types=objects.purchase_types %}
 <body>
	<div class="content-main">
		<fieldset>
			<legend><h2 class="head-title" >采购单</h2></legend>
			<div class="content-base-info">
				<div><input type="hidden" id="id_exchange_trade" value="{{ trade.id }}" /></div>
				<table class="table table-bordered table-striped table-condensed">
					<tr>
						<td>
							<label for='supplier'>供&nbsp;&nbsp;应&nbsp;&nbsp;商</label>
							<select id='supplier'>
								<option value='' >----请选择----</option>
								{% for supplier in  suppliers %}
								<option value='{{ supplier.id }}' >{{ supplier.supplier_name }}</option>
								{% endfor %}
							</select>
							<a><icon class="icon-plus"></icon></a>
						</td>
						<td>
							<label for='deposite'>仓&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;库</label>
							<select id='deposite'>
								<option value='' >----请选择----</option>
								{% for deposite in  deposites %}
								<option value='{{ deposite.id }}' >{{ deposite.deposite_name}}</option>
								{% endfor %}
							</select>
							<a><icon class="icon-plus"></icon></a>
						</td>
						<td>
							<label for='purchase_type'>采购类型</label>
							<select id='purchase_type'>
								<option value='' >----请选择----</option>
								{% for purchase_type in  purchase_types %}
								<option value='{{ purchase_type.id }}' >{{ purchase_type.type_name }}</option>
								{% endfor %}
							</select>
							<a><icon class="icon-plus"></icon></a>
						</td>
					</tr>
					<tr>
						<td>
							<label for='service_date'>业务日期</label>
							<input type="text" id="service_date" class="simple-text" />
						</td>
						<td>
							<label for='forecast_date'>预计到货日期</label>
							<input type="text" id="forecast_date" class="simple-text" />
						</td>
						<td>
							<label for='post_date'>发货日期</label>
							<input type="text" id="post_date" class="simple-text" />
						</td>
					</tr>
					<tr>
						<td>
							<label for='extra_name'>自定义</label>
							<textarea id="extra_name"  rows="2" cols="20"></textarea>
						</td>
						<td>
							<label for='extra_info'>自定义</label>
							<textarea id="extra_info"  rows="2" cols="120"></textarea>
						</td>
						<td style="text-align:center;margin:20px 0;"><button id="id_save_trade" class="btn btn-large btn-primary">保存 +</button></td>
					</tr>
				</table>
			</div>
			<div class="order-content">
				<div class="orders-panel">
					<div>
						<h4 class="head-left" id="id-purchaseitem-head">
							采购项目列表
						</h4>
						<a class="head-right"><icon class="icon-folder-open" title="文件导入"></icon></a>
					</div>
					<div id="id-return-goods">
						<table id="purchaseitem-table" class="table table-bordered table-condensed">
							<thead>
									<th>编号</th>
									<th>供应商编码</th>
									<th>采购产品</th>
									<th>规格</th>
									<th>单价</th>
									<th>采购数量</th>
									<th>总费用</th>
									<th>实付</th>
									<th>操作</th>
							</thead>
							<tbody>
								<tr class="odd">
									<td>1</td>
									<td>Trident</td>
									<td>Internet Explorer 4.0</td>
									<td>Win 95+</td>
									<td class="center"> 4</td>
									<td class="center">X</td>
									<td class="center"> 4</td>
									<td class="center">X</td>
									<td>
										<a class="edit" href=""><icon class="icon-pencil"></icon></a>
										<a class="delete" href=""><icon class="icon-remove"></icon></a>
									</td>
								</tr>
								<tr class="even">
									<td>2</td>
									<td>Trident</td>
									<td>Internet Explorer 5.0</td>
									<td>Win 95+</td>
									<td class="center">5</td>
									<td class="center">C</td>
									<td class="center"> 4</td>
									<td class="center">X</td>
									<td>
										<a class="edit" href=""><icon class="icon-pencil"></icon></a>
										<a class="delete" href=""><icon class="icon-remove"></icon></a>
									</td>
								</tr>
							</tbody>
						</table>
					</div>
				</div>
			</div>
			<hr/>
			<div class="content-search">
				<div class="navbar-search product-search">
					<input type="text" id="id_prod_q" class="search-query"  placeholder="商品搜索" />
				</div>
			</div>
			<hr/>
			<div id="id-prod-search-dialog" style="">
				<table id="id-prod-search-table" class="table table-bordered">
					<thead>
							<th>序号</th>
							<th>图片</th>
							<th>商家编码</th>
							<th>商品简称</th>
							<th>库存数</th>
							<th>均价</th>
							<th>操作</th>
					</thead>
					<tbody>
					</tbody>
				</table>
			</div>
		</fieldset>
	</div>
</body>
{% endwith %}
<script src="{{ STATIC_URL }}script/base.js"></script>
<script src="{{ STATIC_URL }}script/purchase/test.js"></script>
<script type="text/javascript">
	 //new test.Manager();
	function restoreRow ( oTable, nRow )
	{
		var aData = oTable.fnGetData(nRow);
		var jqTds = $('>td', nRow);
		
		for ( var i=0, iLen=jqTds.length ; i<iLen ; i++ ) {
			oTable.fnUpdate( aData[i], nRow, i, false );
		}
		
		oTable.fnDraw();
	}
	
	function editRow ( oTable, nRow )
	{
		var aData = oTable.fnGetData(nRow);
		var jqTds = $('>td', nRow);
		jqTds[0].innerHTML = '<input type="text" value="'+aData[0]+'">';
		jqTds[1].innerHTML = '<input type="text" value="'+aData[1]+'">';
		jqTds[2].innerHTML = '<input type="text" value="'+aData[2]+'">';
		jqTds[3].innerHTML = '<input type="text" value="'+aData[3]+'">';
		jqTds[4].innerHTML = '<input type="text" value="'+aData[4]+'">';
		jqTds[5].innerHTML = '<a class="edit" href="">Save</a>';
	}
	
	function saveRow ( oTable, nRow )
	{
		var jqInputs = $('input', nRow);
		oTable.fnUpdate( jqInputs[0].value, nRow, 0, false );
		oTable.fnUpdate( jqInputs[1].value, nRow, 1, false );
		oTable.fnUpdate( jqInputs[2].value, nRow, 2, false );
		oTable.fnUpdate( jqInputs[3].value, nRow, 3, false );
		oTable.fnUpdate( jqInputs[4].value, nRow, 4, false );
		oTable.fnUpdate( '<a class="edit" href="">Edit</a>', nRow, 5, false );
		oTable.fnDraw();
	}
	
	$(document).ready(function() {
	    var oTable = $('#purchaseitem-table').dataTable({
	   		//"bJQueryUI": true,
			"bAutoWidth": false, //自适应宽度
			"aaSorting": [[1, "asc"]],
			"sPaginationType": "full_numbers",
			"sDom": '<"H"Tfr>t<"F"ip>',
			"oLanguage": {
				//"sLengthMenu": "每页 _MENU_ 条",
				"sZeroRecords": "抱歉， 没有找到",
				"sInfo": "从 _START_ 到 _END_ /共 _TOTAL_ 条",
				"sInfoEmpty": "没有数据",
				"sSearch": "搜索",
				"sInfoFiltered": "(从 _MAX_ 条数据中检索)",
				"oPaginate": {
					"sFirst": "首页",
					"sPrevious": "前一页",
					"sNext": "后一页",
					"sLast": "尾页"
				},
				"sZeroRecords": "没有检索到数据",
				"sProcessing": "<img src='/static/img/loading.gif' />"
			}		
		});
	    var nEditing = null;
    	$('#new').click( function (e) {
			e.preventDefault();
	
			var aiNew = oTable.fnAddData( [ '', '', '', '', '', 
				'<a class="edit" href="">Edit</a>', '<a class="delete" href="">Delete</a>' ] );
			var nRow = oTable.fnGetNodes( aiNew[0] );
			editRow( oTable, nRow );
			nEditing = nRow;
		} );

		$('#purchaseitem-table a.delete').live('click', function (e) {
			e.preventDefault();
	
			var nRow = $(this).parents('tr')[0];
			oTable.fnDeleteRow( nRow );
		} );

		$('#purchaseitem-table a.edit').live('click', function (e) {
			e.preventDefault();
	
			/* Get the row as a parent of the link that was clicked on */
			var nRow = $(this).parents('tr')[0];
	
			if ( nEditing !== null && nEditing != nRow ) {
				/* Currently editing - but not this row - restore the old before continuing to edit mode */
				restoreRow( oTable, nEditing );
				editRow( oTable, nRow );
				nEditing = nRow;
			}
			else if ( nEditing == nRow && this.innerHTML == "Save" ) {
				/* Editing this row and want to save it */
				saveRow( oTable, nEditing );
				nEditing = null;
			}
			else {
				/* No edit in progress - let's start one */
				editRow( oTable, nRow );
				nEditing = nRow;
			}
		} );
	} );
</script>
</html>