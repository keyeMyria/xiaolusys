{% load custom_filter %}
<!DOCTYPE html>
<html lang="zh-cn">
    <head>
        <meta charset="utf-8">
        <title>缺货统计</title>
        <link href="{{ STATIC_URL }}bootstrap/css/bootstrap3.2.0.min.css" rel="stylesheet">
        <style>
         .portfolio-box img {
             width: 100px;
             box-shadow: 2px 2px 5px rgba(187, 187, 187, 0.5);
             -webkit-transition: -webkit-transform 0.2s ease-out;
             -moz-transition: -moz-transform 0.2s ease-out;
             -o-transition: -o-transform 0.2s ease-out;
             transition: transform 0.2s ease-out;
         }

         .portfolio-box img:hover {
             -webkit-transform: scale(1) rotate(20deg);
             -moz-transform: scale(1) rotate(20deg);
             -o-transform: scale(1) rotate(20deg);
             -ms-transform: scale(1) rotate(20deg);
             transform: scale(1) rotate(20deg);
         }

         .supplier {
             margin: 0;
             padding: 0 20px;
             display: none;
             overflow: visible;
         }

         #supplier-btns {
             padding: 0 20px;
         }
        </style>
    </head>
    <body>
        <div class="container" style="width:98%;margin-top:10px">
            <div class="row">
                <div class="btn-toolbar" role="toolbar" id="supplier-btns">
                    {% for supplier in suppliers %}
                    <button type="button" class="btn btn-default" value="{{supplier.id}}">
                        {{ supplier.supplier_name }}
                        <small>{{ supplier.buyer_name }}</small>
                    </button>
                    {% endfor %}
                    <a class="btn btn-default{% if show_ab %} btn-success{% endif %}"
                       href="/sale/dinghuo/instant_dinghuo?show_ab={% if show_ab %}0{% else %}1{% endif %}">仅显示异常</a>
                </div>
            </div>
            {% for supplier in suppliers %}
            <div class="supplier" data-supplier-id="{{ supplier.id }}" style="overflow:visible;">
                <div class="row">
                    <h2>{{ supplier.supplier_name }} <small>{{ supplier.buyer_name }}</small></h2>
                </div>
                <div class="row">
                    <table class="table table-striped">
                        <tr>
                            <th>商品名</th>
                            <th width="300px">编码</th>
                            <th width="100px">图片</th>
                            <th width="300px">尺寸</th>
                            <th width="100px">状态</th>
                            <th width="100px">销售数量</th>
                            <th width="150px">已拍未到数量</th>
                            <th width="120px">已到数量</th>
                            <th width="120px">次品数量</th>
                            <th width="120px">库存数量</th>
                        </tr>
                        {% for product in supplier.products %}
                        {% for sku in product.skus %}
                        <tr class="sku">
                            {% if forloop.first %}
                            <td rowspan="{{ product.skus|length }}">{{ product.name }}</td>
                            <td rowspan="{{ product.skus|length }}">{{ product.outer_id }}</td>
                            <td rowspan="{{ product.skus|length }}">
                                <div class="portfolio-box">
                                    <img src="{{ product.pic_path }}" class="img-circle">
                                </div>
                            </td>
                            {% endif %}
                            <td>{{ sku.properties_name }}</td>
                            <td{%if sku.effect_quantity > 0 %} class="ab-more"{% elif sku.effect_quantity < 0 %} class="ab-less"{% endif %}>
                                {% if sku.effect_quantity > 0 %}
                                多{{ sku.effect_quantity }}件
                                {% elif sku.effect_quantity < 0 %}
                                少{{ sku.effect_quantity|abs }}件
                                {% endif %}
                            </td>
                            <td>
                                <a href="/admin/dinghuo/orderdetail/?q={{sku.id}}" target="_blank">
                                    {{ sku.sale_quantity }}
                                </a>
                            </td>
                            <td>
                                <a href="/sale/dinghuo/statsbypid/{{product.id}}/?showt_begin={{ two_weeks_ago|date:'Y-m-d' }}" target="_blank">
                                    {{ sku.buy_quantity }}
                                </a>
                            </td>
                            <td>{{ sku.arrival_quantity }}</td>
                            <td>{{ sku.inferior_quantity }}</td>
                            <td>
                                <a href="/admin/items/productsku/?q={{sku.id}}" target="_blank">
                                    {{ sku.quantity }}
                                </a>
                            </td>
                        </tr>
                        {% endfor %}
                        {% endfor %}
                    </table>
                </div>
            </div>
            {% endfor %}
        </div>
        <script src="{{ STATIC_URL }}jquery/jquery-1.8.13.min.js"></script>
        <script type="text/javascript" src="{{ STATIC_URL }}underscore/underscore-min.js"></script>
        <script src="{{ STATIC_URL }}bootstrap/js/bootstrap-3.2.0.min.js"></script>
        <script>
         $(function(){
             $('#supplier-btns button[value]').click(function(){
                 $(this).toggleClass('btn-success');
                 $(_.template('div[data-supplier-id="<%= id %>"]')({id: $(this).val()})).slideToggle();
             });
         });
        </script>
    </body>
</html>
