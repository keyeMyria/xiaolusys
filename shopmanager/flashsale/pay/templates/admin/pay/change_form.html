{% extends "admin/change_form.html" %}
{% load i18n %}
{% load url from future %}
{% block extrahead %}{{ block.super }}

<script src="{{ STATIC_URL }}jquery/jquery.js"></script>
<script>
    $(document).ready(function() {
    	$('input[name="_addanother"]').hide();
    	$('input[name="_continue"]').hide();
    	if ($('#refund_refuse_id')!='undifined'){
    		$('#refund_refuse_id').insertAfter('.submit-row>input:last');
    	}
    	
        if ($('#refund_confirm_id')!='undifined'){
        	$('#refund_confirm_id').insertBefore('.submit-row>input:first'); 
        }

        if ($('#refund_complete_id')!='undifined'){
        	$('#refund_complete_id').insertBefore('.submit-row>input:last');
        }
        
        if ($('#refund_invoke_id')!='undifined'){
        	$('#refund_invoke_id').insertAfter('.submit-row>input:last');
        }
        
    });
</script>
{% endblock extrahead %}







{% block after_field_sets %}{{ block.super }}

{% if original.reason == "开线/脱色/脱毛/有色差/有虫洞"%}
    <script>
        function release_coupon_action(order_id,buyer_id,cou_type) {
            event.preventDefault();//阻止提交
            console.log("{{ original.reason }}");
            var POST_COUPON = {
                typ_5: 'POST_FEE_5',
                typ_10: 'POST_FEE_10',
                typ_15: 'POST_FEE_15'
            };
            var btn = $(".post_fee");
            if(btn.hasClass('loading')){
                return
            }
            btn.addClass('loading');
            var coupon_type = POST_COUPON.typ_5;
            if(cou_type==10){
                coupon_type = POST_COUPON.typ_10;
            }
            else if(cou_type==15){
                coupon_type = POST_COUPON.typ_15;
            }
            var coupon_url = "/mm/rsrc/";

            var data = {"buyer_id":buyer_id,"order_id":order_id,"template":coupon_type};
            console.log('data:',data);
            $.ajax({
                url:coupon_url,
                type:"post",
                data:data,
                success:couponCallBack
            });
            function couponCallBack(res){
                btn.removeClass('loading');
                console.log("debug res:",res);
                if(res=="arg_error"){
                    alert("参数错误");
                }
                else if(res=="already"){
                    alert("已经发过了");
                }
                else if(res=="ok"){
                    alert("发送成功");
                }
            }
        }
    </script>
    <br><br>
    <button id="release_coupon_5" class="post_fee" style="font-size: 15px;" onclick="release_coupon_action({{ original.order_id }},{{ original.buyer_id }},5)">发邮费优惠券(￥5)</button>
    <button id="release_coupon_10" class="post_fee"  style="font-size: 15px;margin-right: 30px;margin-left: 30px" onclick="release_coupon_action({{ original.order_id }},{{ original.buyer_id }},10)">发邮费优惠券(￥10)</button>
    <button id="release_coupon_15" class="post_fee"   style="font-size: 15px;" onclick="release_coupon_action({{ original.order_id }},{{ original.buyer_id }},15)">发邮费优惠券(￥15)</button>
{% endif %}

{% if original.refund_no %}
{% if  original.status == 3 or original.status == 4 or original.status == 5 %}
<input id="refund_confirm_id" type="submit" value="同意退款" class="default"  name="_refund_confirm" style="margin-right: 20px;margin-left: 20px;" >
<input id="refund_refuse_id" type="submit" value="驳回重申" class="default"  name="_refund_refuse" style="margin-right: 20px;margin-left: 20px;">
{% elif original.status == 6 %}
<input id="refund_complete_id" type="submit" value="确认退款完成" class="default"  name="_refund_complete" style="margin-right: 20px;margin-left: 20px;">
<input id="refund_invoke_id" type="submit" value="未收到重新退款" class="default"  name="_refund_invoke" style="margin-right: 20px;margin-left: 20px;">
{% endif %}
{% endif %}
{% endblock after_field_sets %}
