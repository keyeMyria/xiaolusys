{% extends "promotion_base.html" %}

{% block title %}{{ title }}{% endblock %}
{% block head_style %}
    <style>
        .share-icon {
            text-align: center;
        }

        .share-icon img {
            width: 40px;
        }

        .active_detail {
            margin-top: 50px;
            text-align: center;
        }

        .form-content {
            text-align: center;
        }

        .submit-order {
            margin-top: 30px;
        }

        .choice {
            padding: 0px 2px;
        }

        .counting {
            display: inline-block;
            padding: 2px 2px;
	    #margin: 4px 12px;
            font-size: 36px;
            #font-weight: 700;
            line-height: 1.1;
            text-align: center;
            border-radius: 4px;
        }

        .visible-border {
            color: #999;
            border: 1px solid #ddd;
        }

        .highlight-border {
            color: orange;
            border: 1px solid orange;
        }

	.join-button {
	  background-image:url(http://7xogkj.com2.z0.glb.qiniucdn.com/join-btn.png);
	  background-repeat:no-repeat;
	  background-size:100%;
	  background-color:transparent;
	  border:0px;
	}

	.invite-count-section {}
	
	.digit {
	  display: inline-block;
	  width: 15%;
	}

	.border-show {
	  border: 1px solid green;
	}

	.border-show-red {
	  border: 1px solid red;
	}


	.hongbao-record {
	  background-image:url(http://7xogkj.com2.z0.glb.qiniucdn.com/222-hongbao.png);
	  background-color:transparent;
	  background-size:auto 100%;
	  background-repeat: no-repeat;
	  margin-bottom: 14px;
	  margin-left: 6px;
	  margin-right: 6px;
	  padding-left: 40px;
	  font-size: 12px;
	}
	.hongbao-total{
	  color: #ffcf00;
	  top: -10px;
	  text-align: center;
	}
	.hongbao-text{
	  color:white;
	}
	.hongbao-time {
	  color:#ffcf00;
	  display: inline-block;
	  margin-bottom: 6px;
	}
	.hongbao-record-bg {
	  background-image:url(http://7xogkj.com2.z0.glb.qiniucdn.com/222-body-bg.png);
	  background-color:transparent;
	  background-size:100% 1px;
	}
	
	.mix-head-image {
	  width:100%;
	  vertical-align:bottom;
	}
	.mix-tail-image {
	  width:100%;
	  vertical-align:top;
	}
	.hongbao-section {
	}
	.share-button-section {
	  text-algin:center;
	  margin-top: 26px;
	  margin-bottom: 26px;
	}
	.share-text {
	  text-align:center;
	  color: white;
	  font-size: 12px;
	  margin-bottom: 6px;
	}

	.share-section{
	  width:100%;
	  border-radius: 6px;
	  position: fixed;
	  left: 0px;
	  bottom: 0px;
	  background-color: white;
	  padding-bottom: 20px;
	  z-index: 1000;
	}
	.share-platforms {
	  margin-top: 10px;
	  margin-bottom: 10px;
	}
	.share-greetings-text {
	  text-align:center;
	  color: #470d88;
	  font-size: 14px;
	  margin:20px 16px;
	  display: inline-block;
	}
	.share-cancel {
	  margin-top:20px;
	  color: gray;
	  text-align: center;
	  font-size: 12px;
	}
	.sleepingbag-section {
	  margin-top:30px;
	}
    </style>
    {% endblock %}

    {% block content2 %}
    {% if res %}
    <div style="position:relative;top:-90px"> 
    <div class="invite-count">
      <div class="row">
	<div class="col-xs-12" style="text-align:center">
	  <div class="digit"><img src="{{ res.first_digit_imgsrc }}" style="width:100%"/></div>
	  <div class="digit"><img src="{{ res.second_digit_imgsrc }}" style="width:100%"/></div>
	</div>
      </div>
      <div class="row">
	<div class="col-xs-12" style="text-align:center">
	  <span style="font-size:10px;color:white">有{{ res.inactive_count }}位好友未激活，查看 >></span>
	</div>
      </div>
    </div>    

    <div class="sleepingbag-section">
      <div class="row">
	<img class="mix-head-image" src="http://7xogkj.com2.z0.glb.qiniucdn.com/222-bg-head-start.png"/>
      </div>
      <div class="row">
	<div class="col-xs-12 hongbao-record-bg">
	  <img src="http://7xogkj.com2.z0.glb.qiniucdn.com/222-bag-yellow.png" style="width:100%"/>
	</div>
      </div>
      <div class="row">
	<img class="mix-tail-image" src="http://7xogkj.com2.z0.glb.qiniucdn.com/222-bg-tail.png"/>
      </div>

    </div>

    <div class="share-button-section">
      <div class="share-text">
	<span>加油哦～预计再邀请 <font style="color:#ffcf00">20</font> 位好友就可得睡袋啦～～</span>
      </div>
      <div>
	<img id="id-share-button" src="http://7xogkj.com2.z0.glb.qiniucdn.com/222-share-button.png" style="width:100%"/>
      </div>
    </div>

    <div id="id-share-section" class="share-section" style="display:none">
      <div class="row share-platforms" id="share_link" cid="{{ res.share_link }}">
	<div class="col-xs-4 share-icon"><img id="shareweixin" src="{{ STATIC_URL }}images/shareweixin.png" alt=""/></div>
	<div class="col-xs-4 share-icon"><img id="sharefirends" src="{{ STATIC_URL }}images/shareFirends.png" alt=""/></div>
	<div class="col-xs-4 share-icon"><img id="shareqq" src="{{ STATIC_URL }}images/shareqq.png" alt=""/></div>
      </div>
      <div class="row share-platforms">
	<div class="col-xs-4 share-icon"><img id="shareqqspace" src="{{ STATIC_URL }}images/shareQQSpacing.png" alt=""/></div>
	<div class="col-xs-4 share-icon"><img id="shareweibo" src="{{ STATIC_URL }}images/shareweibo.png" alt=""/></div>
	<div class="col-xs-4 share-icon"><img id="sharecopylink" src="{{ STATIC_URL }}images/sharecopylink.png" alt=""/></div>
      </div>
      <div class="share-cancel">
	<span id="id-cancel-button">取消分享</span>
      </div>
    </div>

    {% if res.reds %}
    <div class="hongbao-section">
      <div class="row">
	<img class="mix-head-image" src="http://7xogkj.com2.z0.glb.qiniucdn.com/222-hongbao-head.png"/>
      </div>
      <div class="row">
	<div class="col-xs-12 hongbao-record-bg">
	  <div class="hongbao-total"><span>总额: ￥{{ res.reds_money }}</span></div>
	  {% for red in res.reds %}
	  <div class="hongbao-record ">
	    <span class="hongbao-time reds_content" cid="{{ red.id }}">{{ red.created }}</span></br>
	    <span class="hongbao-text">{{ red.content }}</span>
	  </div>
	  {% endfor %}
    <span id="exchange_reds">点击兑换</span>
	</div>
      </div>
      <div class="row">
	<img class="mix-tail-image" src="http://7xogkj.com2.z0.glb.qiniucdn.com/222-hongbao-tail.png"/>
      </div>
    </div>
    {% endif %}
    </div>

    {% endif %}
    {% endblock %}

    {% block content4 %}
    {% if not res %}
    <div class="row">
      <div class="col-xs-2"></div>
      <div class="col-xs-8">
	<a class="join-button form-control" href="" value="" type="button"></a>
	<!--
        <form action="" method="post">
          <input type="text" value="{{ pro.sample.outer_id }}" name="outer_id" hidden="hidden"/>
          <span style="color: red">{{ error_message }}</span>
          <button class="btn btn-default form-control submit-order" type="submit" style="background: #FF8800;color:white">激活申请</button>
        </form>
	-->
      </div>
      <div class="col-xs-2"></div>
    </div>
    {% endif %}

<!--
    <div class="col-xs-12" style="text-align: center">
        <h4>中奖名单</h4>
    </div>

    <div class="col-xs-12" style="text-align: center" id="short_result">

    </div>



    <div class="col-xs-12 active_detail" style="text-align: center">
        <a href="/sale/promotion/pmt_res/1/1/1602/">更多中奖名单</a>
    </div>

    <div id="nativeShare"></div>
-->
{% endblock %}


{% block tail_script %}

    <script>
        var OSTest = function () {// 客户端平台检测　返回
            var u = navigator.userAgent;
            var isAndroid = u.indexOf('Android') > -1 || u.indexOf('Adr') > -1; //android终端
            var isiOS = !!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/); //ios终端
            if (isAndroid == true) {
                return 'Android';
            }
            else if (isiOS == true) {
                return 'iOS';
            }
            else {
                return 'web'
            }
        };
        function share_to(uform) {
            var os = OSTest();
            var share_link = $("#share_link").attr('cid');
            if (os == 'iOS') {
                window.location = 'wx25fcb32689872499://?platform=' + uform + '&url=' + share_link + '&ufrom=' + uform;
            }
            else if (os == 'Android') {
                // 调用android客户端接口内容
                if (window.AndroidBridge) {
                    window.AndroidBridge.getPromotionParams(uform, share_link);
                }
            }
            else {
            }
        }
        // 显示中奖结果30名
        function show_short_rest() {
            console.log('short res');
            var Url = "/sale/promotion/pmt_short_res/";
            $.ajax({
                type: 'get',
                url: Url,
                dataType: 'json',
                success: resCallBack
            });


            function resCallBack(res) {
                console.log(res);
                $.each(res, function (index, da) {
                    var html = '<div class="col-xs-2"></div>' +
                            '<div class="col-xs-9">' +
                            '<img src="' + da[3] + '" alt="" width="40px"/>' +
                            '<span>' + da[0] + '</span></div>';
                    $("#short_result").append(html);

                })
            }
        }

        // 兑换红包
        function exchange_reds(){
            var reds = $(".reds_content");
            var data = new FormData();

            $.each(reds,function(index,red){
                var cid = $(red).attr('cid');
                data.append('ids', cid);
            });
            console.log('data:', data);

            var Url = "/sale/promotion/exchange_reds/";
            $.ajax({
                type: 'post',
                url: Url,
                data: data,
                processData: false,
                contentType: false,
                success: resCallBack
            });
            function resCallBack(res){
                console.log(res);
            }
        }

        $(document).ready(function () {
            //show_short_rest();
            //'wxapp', 'pyq', 'qq', 'sinawb', 'web', 'qqspa'
            $("#exchange_reds").click(function(){// 点击兑换
                exchange_reds();
            });
            $("#sharecopylink").click(function () {
                console.log("复制链接");
                var uform = 'web';
                share_to(uform);
            });
            $("#sharefirends").click(function () {
                console.log("朋友圈");
                var uform = 'pyq';
                share_to(uform);
            });
            $("#shareqq").click(function () {
                console.log("qq");
                var uform = 'qq';
                share_to(uform);
            });
            $("#shareqqspace").click(function () {
                console.log("qq空间");
                var uform = 'qqspa';
                share_to(uform);
            });
            $("#shareweibo").click(function () {
                console.log("微博");
                var uform = 'sinawb';
                share_to(uform);
            });
            $("#shareweixin").click(function () {
                console.log("微信");
                var uform = 'wxapp';
                share_to(uform);
            });
        });


        var selectedColorElement = $("#id-color-yellow");
        var selectedSizeElement = $("#id-size-3");

        function clearColorSelection() {
            selectedColorElement.removeClass("highlight-border");
            selectedColorElement.addClass("visible-border");
        }

        function clearSizeSelection() {
            selectedSizeElement.removeClass("highlight-border");
            selectedSizeElement.addClass("visible-border");
        }

        $("#id-color-yellow").click(function () {
            var target = $("#id-color-yellow");
            if (target != selectedColorElement) {
                clearColorSelection();
                target.addClass("highlight-border");
                selectedColorElement = target;
            }
        });

        $("#id-color-blue").click(function () {
            var target = $("#id-color-blue");
            if (target != selectedColorElement) {
                clearColorSelection();
                target.addClass("highlight-border");
                selectedColorElement = target;
            }
        });

        $("#id-color-pink").click(function () {
            var target = $("#id-color-pink");
            if (target != selectedColorElement) {
                clearColorSelection();
                target.addClass("highlight-border");
                selectedColorElement = target;
            }
        });

        $("#id-size-3").click(function () {
            var target = $("#id-size-3");
            if (target != selectedColorElement) {
                clearSizeSelection();
                target.addClass("highlight-border");
                selectedSizeElement = target;
            }
        });

        $("#id-size-5").click(function () {
            var target = $("#id-size-5");
            if (target != selectedColorElement) {
                clearSizeSelection();
                target.addClass("highlight-border");
                selectedSizeElement = target;
            }
        });

        $("#id-share-button").click(function () {
	  $("#id-share-section").slideDown();
	});

        $("#id-cancel-button").click(function () {
	  $("#id-share-section").slideUp();
	});

	
    </script>
{% endblock %}
