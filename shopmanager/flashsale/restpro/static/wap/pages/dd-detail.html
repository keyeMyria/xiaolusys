<!DOCTYPE html>
<html>
<head>
<title>小鹿美美</title>
<meta charset="utf-8">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" id="viewport">
<script src="../js/common.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/sweet-alert.css">
<link rel="stylesheet" href="../css/common.css">
<link rel="stylesheet" href="../css/tmdd.css">
</head>
<body>
<div class="header">
  <a class="back" href="javascript:history.go(-1)"></a>
  <h1>订单详情</h1>
</div>

<!-- 订单信息 start -->
<div class="panel basic">
  <div class="panel-top">
      
  </div>
  <div class="panel-bottom">

  </div>
</div>
<!-- 订单信息 end -->
<!-- 物流信息 start -->
<div class="panel wuliu">
<!--<div class="panel-top">
    <p class="bianhao">订单编号：<span>1571938491</span></p>
    <p class="daohuo">预计到货时间：<span>2015-05-15</span></p>
    <div class="btn-qianshou" id="js-btn-qianshou">确认签收</div>
  </div> 
  -->
  <div class="panel-bottom">
    <ul class="step-list">
     <!-- <li>
        <p class="text">您的订单已提交</p>
        <p class="time">2015-05-15   12:30:21</p>
        <div class="dotted"></div>
      </li>
      <li>
        <p class="text">您的订单已出货</p>
        <p class="time">2015-05-15   12:36:21</p>
        <div class="dotted"></div>
      </li>
      <li></li>  -->
    </ul>
   
  </div>
</div>
<!-- 收货信息 start -->
<div class="panel shouhuo">
  <div class="panel-top">
    <h2>收货信息</h2>
  </div>
  <div class="panel-bottom">
  </div>
</div>
<!-- 收货信息 end -->

<!-- 费用详情 start -->
<div class="panel feiyong">
  <div class="panel-top">
    <h2>费用详情</h2>
  </div>
  <div class="panel-bottom">
  
  </div>
</div>
<!-- 费用详情 end -->
<div class="buy_button">

</div>
<div class="template">
<script id="top_template" type="text/html">
    <ul class="u1">
      <li><label class="c5f5f5e">订单状态：</label><span class="caaaaaa" id="status_display">{{ status_display }}</span></li>
      <li><label class="c5f5f5e">订单编号：</label><span class="caaaaaa">{{ tid }}</span></li>
      <li><label class="c5f5f5e">订单时间：</label><span class="caaaaaa">{{ created }}</span></li>
      <li><label class="c5f5f5e">订单金额：</label><span class="cf353a0"><em>¥</em>{{ payment }}</span></li>
    </ul>
    <a  class="btn_top_{{ status }} btn_top_style btn_interactive " cid="{{ status }}" href="tuikuan.html?id={{ id }}"></a>
</script>
<script id="button_buy" type="text/html">
    <div class="btn-wrap">
        <a class="btn-buy">购&nbsp;&nbsp;买</a>
    </div>
</script>
</div>
<script src="//cdn.bootcss.com/jquery/2.1.4/jquery.min.js"></script>
<script src="../js/pingpp_pay.js"></script>
<script src="../js/pingpp_ap.js"></script>
<script src="../js/tmdd.js"></script>
<script src="../js/tmpay.js"></script>
<script src="../js/sweet-alert.min.js"></script>
<script type="text/javascript">
(function($){
	
	
	
  //返回顶部
  $('#js-scroll-top').on('touchend',function(e){
    e.preventDefault();
    $('body').animate({scrollTop:0},400);  
  });

  var startY;

  document.addEventListener('touchstart',function (ev) {
    startY = ev.touches[0].pageY;
  }, false);

  document.addEventListener('touchend',function (ev){
    var endY = ev.changedTouches[0].pageY;
    var dir = startY - endY;
    if(dir>0){
      $('#js-fixed-nav').hide();
    }else{
      $('#js-fixed-nav').show();
    }
  }, false);
  
  var urlParams = parseUrlParams(window.location.href);
  var urlConf = {'trade_id':urlParams['id']};
  var order_url = GLConfig.get_trade_details_url.template(urlConf);

  //获取待支付订单列表
  Set_order_detail(order_url);
  //确认支付事件响应
  $(document).on({
  	click:Confirm_charge,
  	touchend:Confirm_charge,
  },'.buy_button .btn-buy');
  //  fang  2015-8-20
  //var status=$("#status_display").innerHTML;
  Wuliu();
})(jQuery);

function Confirm_charge(){
	var urlParams = parseUrlParams(window.location.href);
  	var urlConf = {'trade_id':urlParams['id']};
    Ctrl_order_charge(GLConfig.waitpay_charge.template(urlConf));
};


function  Wuliu(){
	
	       var urlParams = parseUrlParams(window.location.href);
  	       var urlConf = {'trade_id':urlParams['id']};
  	       //获取物流信息
    //alert(urlParams['id'])
    var requestUrl =  "/rest/wuliu/";
    var requestCallBack = function (info) {
		//alert(ret);
	    
	    if(info.response_content.result){
	    
		if (parseInt(info.response_content.ret.status)>1){
		var	data1=info.response_content.ret.data;
		if (data1.length>2){
		for (var i = data1.length-2; i < data1.length; i++) {
			   if(i>data1.length-2){
				   
                var address = "<li> <p class='text'>"+data1[i].content+"</p><p class='time'>"+data1[i].time+"</p><div class='dotted'></div></li><li></li>"
            $(".step-list").append(address)
        }
        else{
			  var address = "<li> <p class='text'>"+data1[i].content+"</p><p class='time'>"+data1[i].time+"</p><div class='dotted'></div></li>"
            $(".step-list").append(address)
	}		
	}
}
	else {
		  for (var i = 0; i < data1.length; i++) {
                var address = "<li> <p class='text'>"+data1[i].content+"</p><p class='time'>"+data1[i].time+"</p><div class='dotted'></div></li><li></li>"
            $(".step-list").append(address)
        }		
	}
}
//针对有物流单，暂时没有数据
else if  (parseInt(info.response_content.ret.status)==1 ) {
	   //加上前一个状态，就是配货
	         var address =" <li><p class='text'>您的商品配货完成</p><p class='time'>"+info.response_content.create_time+"</p><div class='dotted'></div> </li>"
            $(".step-list").append(address)
	
	      var address =" <li><p class='text'>您的商品已出库</p><p class='time'>"+info.response_content.time+"</p><div class='dotted'></div> </li><li></li>"
            $(".step-list").append(address)
}

//根据从数据库来查询的数据的格式
else{
	  		var	data1=info.response_content.ret;
		if (data1.length>2){
		for (var i = data1.length-2; i < data1.length; i++) {
			   if(i>data1.length-2){
				   
                var address = "<li> <p class='text'>"+data1[i].content+"</p><p class='time'>"+data1[i].time+"</p><div class='dotted'></div></li><li></li>"
            $(".step-list").append(address)
        }
        else{
			  var address = "<li> <p class='text'>"+data1[i].content+"</p><p class='time'>"+data1[i].time+"</p><div class='dotted'></div></li>"
            $(".step-list").append(address)
	}		
	}
}
	else {
		  for (var i = 0; i < data1.length; i++) {
                var address = "<li> <p class='text'>"+data1[i].content+"</p><p class='time'>"+data1[i].time+"</p><div class='dotted'></div></li><li></li>"
            $(".step-list").append(address)
        }		
	}
	
	
	
    }
  }  


else{
	 
	var address =" <li><p class='text'>"+info.response_content.message+"</p><p class='time'>"+info.response_content.time+"</p><div class='dotted'></div> </li><li></li>"
            $(".step-list").append(address)
	
}
}
    // 发送请求
    $.ajax({
        type: 'get',
        url: requestUrl,
        data: {'tid':urlParams['id']},
        dataType: 'json',
        success: requestCallBack
    });
  	       
	
}
</script>
</body>
</html>
