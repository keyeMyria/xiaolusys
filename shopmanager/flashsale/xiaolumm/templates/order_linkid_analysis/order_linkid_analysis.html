{% extends "order_linkid_analysis/order_linkid_base.html" %}

{% block title %} 订单链接来源分析 {% endblock %}

{% block head_script %}

    <link href='{{ STATIC_URL }}css/mama_profile.css' rel='stylesheet'/>
    <link href="{{ STATIC_URL }}jquery-timepicker-addon/timepicker/jquery-ui-timepicker-addon.css" type="text/css"/>
    <script src="{{ STATIC_URL }}jquery/jquery-ui-1.8.13.min.js"></script>
    <script src="{{ STATIC_URL }}jquery-timepicker-addon/timepicker/jquery-ui-timepicker-addon.js"
            type="text/javascript"></script>
    <script src="{{ STATIC_URL }}jquery-timepicker-addon/js/jquery-ui-timepicker-zh-CN.js"
            type="text/javascript"></script>

    <style type="text/css">
        th {
            width: 50px;
        }

        td {
            width: 50px;
        }
    </style>
{% endblock %}

{% block container %}

    <div class="container" style="margin-top: 50px;margin-bottom: 20px">
        <h3>订单数量来源分布<span class="label label-primary">按照专属链接</span></h3>

        <div class="input-group ">
            <span class="input-group-addon" id="date_from">开始时间</span>
            <input type="text" name="date_from" id="left_date_pic_prov"
                   class="form-control select_saletime  datepicker" placeholder="2015-03-01"
                   value="2015-03-01"
                   aria-describedby="basic-addon1">

            <span class="input-group-addon" id="date_to">结束时间</span>
            <input type="text" name="date_to" id="right_date_pic_prov"
                   class="form-control select_saletime  datepicker" placeholder="{{ today }}" value="{{ today }}"
                   aria-describedby="basic-addon2">
            <span class="input-group-btn">
                <button class="btn btn-default" id="go_search_province">Go!</button>
            </span>
        </div>
    </div>
    <div id="tab_cup" class="container"></div>

{% endblock %}

{% block tail_script %}
    <script>
        $(function () {
            $("#left_date_pic_prov").datepicker({
                dateFormat: "yy-mm-dd"
            });
            $("#right_date_pic_prov").datepicker({
                dateFormat: "yy-mm-dd"
            });

        });
        var t_id = 0;
        $(document).ready(function () {

            $("#go_search_province").click(function () {
                var url = "/m/order_linkid_analysis/";
                var time_from = $("#left_date_pic_prov").val();
                var time_to = $("#right_date_pic_prov").val();
                var data = {"time_from": time_from, "time_to": time_to};
                console.log(data);

                function callback(res) {
                    //生成table容器

                    var table_container = '<div class="panel col-md-4 panel-default container" id="createtable_' + t_id + '">' +
                            '<div class="panel-heading">' + time_from + '至' + time_to + '</div></div>';
                    $("#tab_cup").append(table_container);
                    console.log(res);
                    var rowCount = res.length;

                    var table = $('<table class="table table-condensed table-hover"><thead><th>链接类型</th><th>订单数量</th><th>占比</th><thead>');
                    table.appendTo($("#createtable_" + t_id));
                    for (var i = 0; i < rowCount; i++) {
                        var tr = $("<tr></tr>");
                        tr.appendTo(table);
                        for (var j = 0; j < 3; j++) {
                            var td = $("<td>" + res[i][j] + "</td>");
                            td.appendTo(tr);
                        }
                    }
                    tr.appendTo(table);
                    $("#createtable_" + t_id).append("</table>");
                    t_id = t_id + 1;

                }

                $.ajax({"url": url, "data": data, "type": "post", "success": callback});

            });
        });
    </script>
{% endblock %}
